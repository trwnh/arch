#!/bin/bash

## post
# login as trwnh

if [ "$(which yay)" != "/usr/bin/yay" ]
then
git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -sic
yay --nodiffmenu --save
cd ..
sudo rm -r yay
echo "Installed yay."
else
echo "yay already installed."
fi

if [ "$(yay -Qqe gnome-disk-utility)" != "gnome-disk-utility" ]
then
yay -S --noconfirm \
  ttf-amiri ttf-arabeyes-fonts ttf-qurancomplex-fonts ttf-sil-lateef ttf-sil-scheherazade \
  ttf-droid ttf-roboto ttf-roboto-slab ttf-roboto-mono \
  noto-fonts noto-fonts-emoji-blob noto-fonts-extra noto-fonts-cjk \
  otf-fira-code otf-fira-sans otf-fira-mono ttf-inconsolata \
  adobe-source-code-pro-fonts adobe-source-sans-pro-fonts adobe-source-serif-pro-fonts \
  nm-connection-editor network-manager-applet \
  materia-gtk-theme materia-kde faenza-icon-theme \
  enpass-bin firefox-developer-edition quassel-client dino \
  gnome-disk-utility
else
echo "Apps and fonts already installed."
fi

## pick a de/wm
echo "Install [xfce, deepin, sway, xfsway, ddesway]: " # TODO: support sway fallbacks of xfce/deepin
read DESKTOP

case $DESKTOP in
xfce)
  yay -S --noconfirm xorg-server xfce4 xfce4-goodies compton
  curl https://raw.githubusercontent.com/trwnh/arch/master/config/compton.conf -o ~/.config/compton.conf
  echo "exec startxfce4" > ~/.xinitrc
  echo "startx" >> ~/.bashrc
;;
deepin)
  yay -S --noconfirm xorg-server deepin deepin-extra
  echo "exec startdde" > ~/.xinitrc
  echo "startx" >> ~/.bashrc
;;
sway)
  yay -S --noconfirm sway wayland xorg-server-xwayland qt5-wayland xfce4-terminal \
    light playerctl pamixer mako ruby-fusuma slurp grim waybar imv \
    thunar gvfs rofi rofi-dmenu
  mkdir ~/.config/sway
  curl https://raw.githubusercontent.com/trwnh/arch/master/config/sway -o ~/.config/sway/config
  curl https://raw.githubusercontent.com/trwnh/arch/master/config/swaystatus.sh -o ~/.config/sway/status.sh
  curl https://wallpapers.wallhaven.cc/wallpapers/full/wallhaven-734403.jpg -o ~/.config/sway/wallpaper.jpg
  sudo chmod +x ~/.config/sway/status.sh
  mkdir ~/.config/fusuma
  echo \
"
interval:
  pinch: 0.1
" \
  > ~/.config/fusuma/config.yml
  echo "if [[ -z "'$'"DISPLAY ]] && [[ "'$'"(tty) = /dev/tty1 ]]; then exec sway; fi" >> ~/.bashrc
;;
esac
