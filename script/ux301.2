#!/bin/bash
## after chrooting, run this

ln -sf /usr/share/zoneinfo/America/Chicago /etc/localtime
hwclock --systohc
sed -i '/#\s%wheel\sALL=(ALL)\sALL/s/^#//g' /etc/sudoers
echo "EDITOR=nano" > /etc/environment
HOSTNAME=ux301
echo "$HOSTNAME" > /etc/hostname
echo "
127.0.0.1 localhost
::1 localhost
127.0.1.1 $HOSTNAME.localdomain $HOSTNAME
" > /etc/hosts
bootctl install
echo "
title Arch Linux
linux /vmlinuz-linux
initrd /intel-ucode.img
initrd /initramfs-linux.img
options root=LABEL=Arch rw
" >> /boot/loader/entries/arch.conf
echo "
default arch
timeout 0
editor yes
" >> /boot/loader/loader.conf
echo "FONT=\"ter-v32b\"" > /etc/vconsole.conf
systemctl enable NetworkManager
systemctl enable systemd-timesyncd
sed -i '/#Color/s/^#//g' /etc/pacman.conf
echo "Configuration complete."
read -p "To avoid having passwd timeout, press [enter] to continue when you're ready to input:" waitforinout
echo "Set a root password."
passwd
# (set root password)
USER=trwnh
useradd -m -g users -s /bin/bash $USER
usermod -aG wheel,ftp,http,input $USER
echo "Created user $USER."
passwd $USER
# (set user password)

echo "You can now unmount and reboot." # if not called via ux301.1, then you should also delete the script and exit chroot.
