#!/bin/bash
## after chrooting, run this

ln -sf /usr/share/zoneinfo/America/Chicago /etc/localtime
hwclock --systohc

echo "en_US.UTF-8 UTF-8
ar_JO.UTF-8 UTF-8" > /etc/locale.gen
locale-gen
echo "LANG=en_US.UTF-8" > /etc/locale.conf

HOSTNAME=ux301
echo "$HOSTNAME" > /etc/hostname
echo "
127.0.0.1 localhost
::1 localhost
127.0.1.1 $HOSTNAME.localdomain $HOSTNAME
" > /etc/hosts

bootctl install
echo "
title Arch Linux
linux /vmlinuz-linux
initrd /intel-ucode.img
initrd /initramfs-linux.img
options root=LABEL=Arch rw
" >> /boot/loader/entries/arch.conf
echo "
default arch
timeout 0
editor yes
" >> /boot/loader/loader.conf

pacman -S terminus-font
echo "FONT=\"ter-v32b\"" > /etc/vconsole.conf

sed -i '/SystemGroup\ssys\sroot/s/root/wheel/g' /etc/cups/cups-files.conf
sed -i '/#Color/s/^#//g' /etc/pacman.conf
sed -i '/#\s%wheel\sALL=(ALL)\sALL/s/^#//g' /etc/sudoers
echo "EDITOR=nano" > /etc/environment

systemctl enable NetworkManager
systemctl enable systemd-timesyncd
systemctl enable org.cups.cupsd

echo "Configuration complete."
read -p "To avoid having passwd timeout, press [enter] to continue when you're ready to input:" waitforinput
echo "Set a root password."
passwd
# (set root password)
USER=trwnh
useradd -m -g users -s /bin/bash $USER
usermod -aG wheel,ftp,http,sys $USER
echo "Created user $USER."
passwd $USER
# (set user password)

echo "You can now unmount and reboot." # if not called via ux301.1, then you should also delete the script and exit chroot.
